"""
Auto-generated semantic module for sanming
Generated at: 2025-12-05T13:30:19.101379
Version: 1.0.0

对照 Requirements 6.4 - 带 @SemanticRegistry.register 装饰器的 Python 模块
"""

from backend.semantics.core.base import SemanticEntry, SemanticRegistry, NarrativeSnippetExtended
from backend.core.contracts import (
    SnippetRole,
    SourceMetadata,
    ConfigRelation,
    EvidenceChainEntry,
    RelationType,
    EffectDirection,
    ConfidenceLevel,
)


@SemanticRegistry.register(
    semantic_id="smth_v1.0.0_十二驿马格与吉凶判_002",
    book_id="sanming",
    engine_id="bazi"
)
class 十二驿马格与吉凶判(SemanticEntry):
    """
    - **原文（source_text）**：
  有干支合马，如申子辰四马在寅，甲寅见己亥合，丙寅见辛亥合，主官职崇重。有马头带剑，谓驿马上见庚辛或纳音见金，主名振边疆。有马骤天庭，谓木人得亥而见辛亥...
    """
    
    original_text: str = """- **原文（source_text）**：
  有干支合马，如申子辰四马在寅，甲寅见己亥合，丙寅见辛亥合，主官职崇重。有马头带剑，谓驿马上见庚辛或纳音见金，主名振边疆。有马骤天庭，谓木人得亥而见辛亥，又马上干逢得禄，如六壬人生居寅午戌之位，于甲上遁得戊午，戊之禄在巳，巳系天庭，复见巳得酉合之为是，主官居极品。有马后二辰为九地马，主职近王廷。有天马贵神，乃岁中不见驿，五虎遁至马上，看得何干，其干见天乙，而天乙所坐之干却复见贵于马上是也，贵不下三品。有一木系双马，寅午戌多见丙申，申子辰多见庚寅，巳酉丑多见己亥，亥卯未多见癸巳：马上干克支，主多惊险；若遇四马聚于时或年上，主封爵。又驿马下生人，月日时支干得御策全，并克身者定贵。马前一辰为御，后一辰为策；假令甲子金命，正月辛丑日卯时生，以子人马在寅逢禄，又本命子与生日丑在马后为策，卯时在马前为御，又马是丙寅，火能克甲子金，故主贵。有驿有马者，主位至侯。干为马，支为驿：如戊戌人马在申而得庚申，支干俱属金，到申临官；戊戌支干俱属土，到申长生，本命及驿马支干背马有气，是有驿有马。又如壬午人驿马在戊申，戊土临申长生，本命壬水到申亦长生，午火到申为衰乡，本命干旺支衰，是有马无驿。又如丁丑人驿马在辛亥，金临亥为病乡，本命丁火到亥为绝，以丑土到亥为临官，本命干衰支旺，驿马干亦衰，是有驿无马。或以寅午戌见庚无申、见申无庚之类，为有马无驿，有驿无马亦通。有马克身者，取驿马之辰能制生月，如寅午戌人马在申，申属金，能制寅卯月木；假令甲子人在辰戌丑未月生是也，主官禄易求，仕宦无滞，少年亨快，为官清显；常人遇之，小富。

- **分字分词释义**：
  - **合马、马头带剑、驤天庭、九地马、天马贵神、一木系双马、有驿有马、马克身**：一系列对驿马与干支、贵人、禄位等组合的高级格局名称。

- **规范化释义（primary_lang_explained）**：
  最后一段罗列了多种「高级驿马形态」：干支合马可显权重职；马头带剑、马骤天庭等多与军旅、边疆、极品官职相关；九地马则主近王庭之职；天马贵神则强调天乙贵人与驿马的叠加；一木系双马、多马聚集等结构主多惊险与封爵之机。有驿有马、马前御、马后策等格局，进一步细化了权力的来源与落点。总体而言，这些形态都是在基本驿马结构上叠加贵神、禄位与克制关系后形成的「精细变格」。

- **核心要点**：
  - 这些高级形态体现的是驿马与贵人、禄位、军权的高度耦合，是少数职业路径（军旅、重臣、高级官僚）的模式模板。
  - 在工程实践中，可以将其视作高度稀有的模式特征，只在特定干支组合下触发，对一般用户保持解释性提示即可，无需频繁使用。
 
- **详细解说**：
  1) 依据原文规则，为命局判断是否存在「合马」「马头带剑」「马骤天庭」「九地马」「天马贵神」「有驿有马」「马克身」等高级形态，并在特征空间中单独标注稀有标签；
  2) 将这些形态主要用于少数高权、高风险职业路径的解释与补强，而不是在普通职业预测中普遍使用，以避免噪音过大；
  3) 在实际实现中，为每一稀有形态设置开关与阈值：仅当规则满足度高（组合清晰、不被空亡重破）且现实数据支持时，才在解释文案中提及；
  4) 在模型训练阶段，可先将这些形态作为「候选特征」放入可解释性分析（feature importance / SHAP）中，视其贡献度决定是否纳入核心特征集。

- 反例与边界：
  - 不宜因检测到某个「马骤天庭」「有驿有马」等名目，就直接向用户宣称「必为将相侯伯」，应强调只是某种风格或倾向的结构相似；
  - 不能忽略现实约束（教育、时代、行业），将古代军权、边镇之象生硬映射到现代职位名称上；
  - 工程上若把这些极少数模式当作主特征训练，会导致模型在数据稀疏区域过拟合，解释虽华丽但预测不稳；
  - 反向误区则是完全屏蔽这类信息，使系统在面对极端高权/高危命例时丧失必要的识别与提醒能力。

- 小例（示意）：
  - 某命局符合「有驿有马、马头带剑」组合，且现实在高强度公共安全/军警体系任职，系统可以用这套语言解释其「在高风险场域中承担重责」的格局，但同步提示健康和家庭平衡的风险；
  - 另一命局虽有一木系双马等形态，但现实从事普通文职工作，系统则将这些结构收敛为「潜在高压、高变化适应力」，而不夸大为必然封爵之象。"""
    normalized_text_zh: str = """"""
    subject: str = "十二驿马格与吉凶判"
    factor_refs: list = ['new_candidate', 'new_candidate', 'new_candidate', 'engine_id', 'bazi_structure_factor_46', 'bazi_semantic', 'bazi_structure_factor_47', 'bazi_semantic', 'bazi_structure_factor_48', 'bazi_semantic', 'bazi_relation_factor_51', 'bazi_semantic', 'bazi_condition_factor_32', 'bazi_semantic']
    
    # 叙事素材（包含 trigger_human）
    narrative_snippets: list = [

    ]
    
    # L2.5 因子关系
    related_semantics: list = [

    ]
    
    # L2.5 证据链
    evidence_refs: list = [

    ]
    
    metadata: SourceMetadata = SourceMetadata(
        book_id="sanming",
        chapter="",
        l1_anchor="smth_v1.0.0_十二驿马格与吉凶判_002_L1",
    )
    version: str = "1.0.0"

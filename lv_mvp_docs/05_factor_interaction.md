# 因子交互模型

> 核心原则：命理因子之间存在复杂的相互作用，结果是多因素博弈的产物

---

## 设计哲学

### ❌ 错误的简单逻辑

```
命理预测：你有偏财运
现实结果：投资失败
结论：预测不准 / 降低偏财权重
```

### ✅ 正确的多因素分析

```
命理因子：
  - 偏财格 → 有投机天赋
  - 比劫旺 → 容易被人分财
  - 流年七杀 → 当年有冲击

现实结果：投资失败

推演分析：
  - 偏财天赋存在（基础能力）
  - 但比劫夺财（合伙人问题？资金被分？）
  - 加上流年七杀冲击（时机不对）

结论：不是"没有偏财运"，而是"偏财被抵消了"
建议：独立决策 + 避开冲击年
```

---

## 因子交互类型

### 1. 生扶关系（增强）

某因子增强另一因子的表现：

| 八字 | 占星 |
|------|------|
| 食伤生财 | 木星合相金星 |
| 官印相生 | 土星三分月亮 |

**系统行为**：识别增强组合，提升相关版本的推荐权重

### 2. 克制关系（削弱）

某因子削弱另一因子的表现：

| 八字 | 占星 |
|------|------|
| 比劫夺财 | 火星刑金星 |
| 枭神夺食 | 土星对冲太阳 |

**系统行为**：识别克制组合，添加风险提示到对应版本

### 3. 冲合关系（转化/波动）

某因子与另一因子发生化学反应：

| 八字 | 占星 |
|------|------|
| 合化（地支六合、天干五合） | 合相（行星会合） |
| 冲击（地支六冲） | 对冲（180度相位） |

**系统行为**：标记为"动态因素"，提示特定时间段的变化

---

## 时间维度

### 静态因子 vs 动态因子

| 类型 | 八字 | 占星 | 更新频率 |
|------|------|------|----------|
| **本命因子** | 四柱、十神、格局 | 本命盘、上升、太阳月亮 | 永不变 |
| **大运因子** | 大运干支 | 行运行星长期相位 | 每 10 年 |
| **流年因子** | 流年干支 | 行运过境 | 每年 |
| **流月因子** | 流月干支 | 月相、日/月蚀 | 每月 |

LV 在生成版本时，必须同时考虑本命 + 动态因子的叠加效果。

---

## 推演逻辑框架

当用户记录行为结果时，系统执行以下分析：

```
输入：用户行为记录（如"投资 A 项目亏损 30%"）

Step 1: 识别相关领域
  → 财富领域

Step 2: 提取相关因子
  本命：偏财格、比劫旺
  流年：七杀透干

Step 3: 分析因子交互
  偏财（能力） vs 比劫（分财） vs 七杀（冲击）
  → 偏财被双重抵消

Step 4: 生成推演结论
  "您的偏财格显示投资潜力，但本次结果可能受以下因素影响：
   1. 比劫旺相：是否涉及合伙或资金共管？
   2. 流年七杀：2025 年为冲击年，激进决策风险较高
   
   建议：偏财天赋仍在，但 2025-2026 宜独立决策、控制仓位"

Step 5: 更新记忆层
  - Event: 记录原始行为
  - Insight: "财富领域 + 比劫影响 + 七杀年"
  - Profile: 不调整偏财权重，而是添加"比劫敏感"标签
```

---

## 重要原则

### 1. LS 永远不"推翻"预测

命理因子是客观存在的，结果不好不代表因子不存在，而是被其他因子抵消或时机不对。

### 2. LS 永远不"强烈推荐"

特别是涉及投资、健康、重大人生决策时：
- ✅ "您在这方面有天赋潜力"
- ✅ "但 XXX 因素可能影响 XXX"
- ❌ "您应该投资这个"
- ❌ "您必须避开这个"

### 3. 解释 > 预测

LV 的核心价值是"解释"：
- 为什么这件事发生了？
- 是哪些因素在起作用？
- 用户可以如何应对？

而不是单纯告诉用户"会发生什么"。

---

## 数据结构设计

### 因子存储

```python
class DestinyFactor:
    factor_id: str           # e.g., "bazi_pianCai", "astro_jupiter_venus_conjunction"
    system: str              # "bazi" | "astrology"
    category: str            # "wealth" | "career" | "relationship" | ...
    base_strength: float     # 0.0 - 1.0, 本命强度
    current_strength: float  # 考虑动态因子后的当前强度
    modifiers: List[FactorModifier]  # 影响此因子的其他因子
```

### 因子修饰器

```python
class FactorModifier:
    source_factor_id: str    # 影响源
    effect_type: str         # "enhance" | "weaken" | "transform"
    effect_strength: float   # 影响程度
    time_scope: str          # "permanent" | "decadal" | "yearly" | "monthly"
    description_zh: str      # "比劫夺财"
```

### 推演记录

```python
class InferenceRecord:
    event_id: str            # 关联的用户行为事件
    factors_involved: List[str]  # 参与分析的因子
    interaction_analysis: str    # 因子交互分析文本
    conclusion: str          # 推演结论
    weight_adjustments: Dict[str, float]  # 不修改本命权重，只记录动态调整
```

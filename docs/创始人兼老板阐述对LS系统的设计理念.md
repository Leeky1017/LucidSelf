# LucidSelf (LS) 产品设计理念

> 本文档面向工程团队和设计团队，阐述LS的愿景、核心机制与系统边界。

---

## 一、LS的两大核心能力："预测" + "推理"

### 1. 预测（Prediction）

**定义**：基于用户出生信息，通过命理计算器自动生成多维度的人生测算。

**触发条件**：用户首次注册时输入个人档案（性别、出生年月日时、出生地点）。

**系统行为**：
- 自动调用所有命理计算器（八字、紫微、占星、易经等）
- 提取全量因子（天干地支、宫位、星曜、卦象等）
- 基于规则引擎生成结构化预测结果（用户无法直接阅读）
- **调用LLM进行润色输出**，将结构化数据转为用户可理解的自然语言

**输出物**：
- 人生级 Playbook（经LLM润色的命盘解读）
- 各维度因子报告（性格、事业、感情、健康等）

**⚠️ 重要**：规则引擎输出的是结构化数据（因子ID、权重、关联关系），用户看不懂。**必须经过一次LLM润色**，转为自然语言后才能展示给用户。

**示例**：用户输入"2003年10月17日15:30，内蒙古包头市，男"，系统计算命盘 → 生成结构化因子 → LLM润色 → 输出人生级Playbook。

---

### 2. 推理（Inference）

**定义**：基于用户的行为记录、精神状态、梦境等动态输入，对命理预测进行校准和细化。

**核心逻辑**：命理给出的是"可能性范围"，推理通过用户的真实反馈来缩小范围、提升精度。

**类比**：
- 预测 = 公司外部估值（基于行业、规模等客观指标）
- 推理 = 公司内部尽调（基于实际运营、团队状态等主观因素）

**数据来源**：
- TO-DO/DONE 行为记录（每条0-100字）
- 梦境日记（Dream Journal）
- 用户主动标注的状态

---

## 二、核心场景：Life Version（人生版本）

### 1. 什么是 Life Version？

Life Version 是 LS 的主交互界面，将用户的人生呈现为"可视化 + 结构化"的版本树。

**核心理念**：人生不是一条固定的路，而是不断分叉、演化的版本树。

---

### 2. Life Version 的三大功能模块

#### 2.1 行为记录（TO-DO / DONE）

**⚠️ 注意：LS 不是日记应用。**

用户通过简短的 TO-DO/DONE 条目记录日常行为：
- 每条限制 **0-100字**
- 记录"做了什么"而非"写了什么"
- 降低LLM意图理解和拆分成本
- 市面日记软件已够多，LS专注行为轨迹

**示例**：
```
✅ 和老板谈了加薪，被拒绝了
✅ 下午跑步5公里
⬚ 明天约朋友吃饭
```

**系统行为**：
- 每日 22:00 自动批处理结构化提取
- 提取结果用于版本树推演
- **用户无感知**

#### 2.2 人生版本树（Version Tree）

**设计思想**：蝴蝶效应 —— 用户的每次选择都可能影响人生走向。

**系统行为**：
- 基于累积的行为数据 + 命理预测，定期生成 2-3 条"可能的人生路径"
- 用户的实际选择会影响下一次版本生成
- 旧预测可能被推翻，新路径会定期出现
- **生成周期**：每周 / 每两周 / 每月

#### 2.3 时间粒度 Playbook

| 粒度 | 生成时机 | LLM调用 |
|------|----------|---------|
| 人生级 | 首次注册后立即生成 | 一次性调用（润色输出） |
| 年度 | 每年初系统自动生成 | 系统驱动 |
| 月度 | 每月初系统自动生成 | 系统驱动 |
| 周度 | 用户点击请求时生成 | 用户触发 |
| 日度 | 用户点击请求时生成 | 用户触发 |

---

## 三、Dream Journal（梦境日记）

### 功能定位

梦境是潜意识的出口，是推理的重要数据源。

### 用户操作

1. 用户记录梦境内容
2. 系统返回解梦分析（心理、生活关联、近期事件映射）
3. 用户可回顾历史梦境记录与解读

### LLM调用规则

- **触发条件**：用户主动提交梦境记录
- **调用方式**：单次调用，返回解读结果
- **成本控制**：每日解梦次数上限（Plus会员3次）

**⚠️ 梦境不触发危机检测**：梦中的危险场景（坠落、死亡等）是潜意识表达，不代表现实意图。

---

## 四、系统驱动 vs 用户驱动（成本控制核心原则）

### 核心理念

> **LS 是"系统驱动用户"，而非"用户压榨系统"。**

### 与通用大模型产品的本质区别

| 维度 | ChatGPT / Claude Plus | LS |
|------|----------------------|-----|
| 交互模式 | 用户主动提问，无限制 | 系统主动推送，用户被动接收 |
| LLM调用频率 | 用户决定 | 系统决定 |
| 问题范围 | 任意问题 | 仅限预设场景 |
| 成本结构 | 订阅制包月 | 精准控制每次调用 |

### LS 的 LLM 调用场景（白名单）

| 场景 | 触发方 | 频率 | 备注 |
|------|--------|------|------|
| **首次Playbook润色** | 系统 | 一次性 | 注册后立即调用 |
| 解梦 | 用户 | 每日上限 | 唯一的用户主动触发场景 |
| 行为记录结构化 | 系统 | 每日22:00 | 批处理 |
| Playbook生成 | 系统 | 周/月 | 批量调度 |
| 版本树更新 | 系统 | 周/双周/月 | 批量调度 |
| 内容润色输出 | 系统 | 按需 | 将规则引擎结果转为自然语言 |

### 禁止的场景

- 用户无限制对话
- 用户自由提问
- 用户反复要求重新生成

---

## 五、用户账号与会员体系

### 1. 注册方式

| 方式 | 说明 |
|------|------|
| Apple ID | iOS 主力注册通道 |
| Google Account | Android 主力注册通道 |
| 邮箱 | 通用兜底方案 |

注册后强制进入 **ProfileSetup**，填写出生信息。

### 2. 会员体系

| 等级 | 价格 | 功能边界 |
|------|------|----------|
| **Free** | 免费 | 仅查看人生级 Playbook（静态） |
| **Plus** | $9.9/月 | 完整功能：TO-DO/DONE、梦境、周/月Playbook、版本树 |

**当前仅做 Free + Plus 两档**，Plus 为订阅制。

### 3. 功能门控

| 功能 | Free | Plus |
|------|------|------|
| 人生级 Playbook | ✅ | ✅ |
| 年/月/周/日 Playbook | ❌ | ✅ |
| Dream Journal（解梦） | ❌ | ✅（每日3次） |
| TO-DO/DONE 记录 | ❌ | ✅ |
| 版本树更新 | ❌ | ✅ |
| 历史数据查看 | 最近7天 | 全量 |

---

## 六、隐私与数据安全

### 1. 核心原则

> **LS 会用用户数据优化体验，但绝不暴露用户隐私。**

### 2. 数据分级

| 级别 | 示例 | 存储方式 |
|------|------|----------|
| **PUBLIC** | 用户昵称、会员等级 | 明文 |
| **PRIVATE** | 出生信息、命盘因子 | 明文但仅用户可见 |
| **SENSITIVE** | 梦境内容、TO-DO/DONE内容 | **AES-256-GCM 加密存储** |

### 3. 后台访问控制

| 角色 | 可见内容 |
|------|----------|
| 运维 | 仅元数据（用户ID、时间戳、数据量） |
| 开发 | 仅测试账号数据 |
| 管理员 | 统计聚合数据 |

**禁止任何人在后台直接查看用户的原文。**

---

## 七、安全合规

### 内容审核

用户输入（TO-DO/DONE）经过内容审核，过滤违法、色情、极端言论。

**⚠️ 梦境内容暂不进行危机检测**，因为梦中的危险场景是潜意识表达。

---

## 八、记忆层架构

### 1. 设计目标

> **让 LS 记住用户的一切，持续积累，越用越懂你。**

### 2. 三层记忆模型

| 层级 | 名称 | 职责 | 数据示例 |
|------|------|------|----------|
| **Event** | 事件层 | 原始记录 | TO-DO/DONE条目、梦境记录、Playbook请求 |
| **Insight** | 洞察层 | 归纳提炼 | "用户近期频繁梦到水，可能与情感压力相关" |
| **Profile** | 画像层 | 长期特征 | `{career_focus: 0.8, emotional_stability: 0.6}` |

### 3. 数据流

```
用户输入（TO-DO/DONE/梦境）
    ↓
Event 层：原始记录存储（SENSITIVE 加密）
    ↓
定时任务（每日22:00）
    ↓
Insight 层：从近期 Event 中提取洞察
    ↓
周期性聚合
    ↓
Profile 层：更新用户画像特征
```

### 4. 记忆如何影响输出

- **Playbook 生成**：结合 Profile 特征调整解读侧重点
- **解梦分析**：结合近期 Event 和 Insight 做关联分析
- **版本树推演**：基于 Event 积累 + Profile 画像生成路径

---

## 九、前端视图与功能映射

### 当前已实现

| 视图 | 功能 |
|------|------|
| **Now** | 主界面，展示 Playbook 和 Dream Journal 入口 |
| **Playbook** | 多体系命理解读 |
| **Dream Journal** | 梦境记录与解读 |
| **Timeline** | 时间线视图 |
| **Archive** | 历史存档 |

### 待开发

| 模块 | 优先级 |
|------|--------|
| TO-DO/DONE 入口 | P0 |
| Version Tree 可视化 | P0 |
| Insights 推送 | P1 |

---

## 十、机器学习系统：用户反馈闭环

### 1. 设计目标

> **通过用户反馈，持续优化规则权重和引擎准确度。**

### 2. 反馈采集

| 类型 | 示例 | 用途 |
|------|------|------|
| **显式正向** | 点击"准" | 提升规则权重 |
| **显式负向** | 点击"不准" | 降低规则权重 |
| **隐式正向** | 停留 >10s | 弱正向信号 |
| **隐式负向** | 快速跳过 | 弱负向信号 |

### 3. 权重调整

```
正向反馈: weight += 0.05
负向反馈: weight -= 0.08  # 负向惩罚更重
```

---

## 十一、设计原则总结

1. **预测靠计算，输出靠润色** —— 命理计算无需LLM，但输出必须经LLM润色。

2. **系统驱动，定时触发** —— LLM调用由系统调度，用户无法无限制触发。

3. **行为记录，不做日记** —— TO-DO/DONE 每条0-100字，降低LLM理解成本。

4. **版本树动态演化** —— 人生不是一成不变的，预测会被修正。

5. **成本可控，质量优先** —— 宁可降低调用频率，也要保证每次输出质量。

6. **隐私优先，加密存储** —— 敏感数据 AES-256 加密，后台无法查看明文。

7. **记忆积累，越用越准** —— 三层记忆架构持续沉淀用户数据。

8. **反馈闭环，持续学习** —— 用户反馈驱动规则权重优化。

# 因子本体总览 v1.0

> 版本：v1.0 | 更新日期：2025-11-21 | 维护者：Factor-Ontology-Agent
>
> **核心定位**：LucidSelf系统的统一变量字典，服务于八字、紫微、西方占星、梦境、心理学等多引擎的语义对齐与规则执行

---

## 1. 因子本体定位

### 1.1 核心定义

因子本体是 LucidSelf（LS）系统的**统一变量字典**，承担以下职责：

- **跨引擎共享**：服务于八字、紫微、西方占星、梦境、心理学等多个推理引擎
- **语义标准化**：提供统一的因子命名、定义、取值范围
- **规则依赖源**：所有L3 Python规则和JSONL factor_refs必须引用本体中的因子

### 1.2 因子状态管理

**仅存在两种状态**：

| 状态 | 定义 | 使用权限 | 升级路径 |
|------|------|----------|----------|
| **existing** | 已正式入库的因子 | ✅ 可被L3 Python规则直接使用<br>✅ 可被JSONL factor_refs引用<br>✅ 可在推理引擎中计算 | 已完成入库流程 |
| **new_candidate** | 候选因子 | ❌ 不允许进入规则代码<br>❌ 不允许在JSONL中引用<br>✅ 只能在精校文档中标注 | 需通过正式变更流程升级 |

### 1.3 因子生命周期

```
精校文档发现新概念
    ↓
标记为 new_candidate
    ↓
系统级任务评估
    ↓
创建因子变更提案
    ↓
分配唯一因子ID
    ↓
升级为 existing
    ↓
可在规则中使用
```

---

## 2. 因子分类框架

### 2.1 结构类因子（Structure）

描述系统的静态结构元素，如命盘组成、星体位置等。

| 子类 | 描述 | 示例因子ID | 适用系统 |
|------|------|------------|----------|
| 天干地支 | 八字四柱结构 | `day_master`, `month_branch`, `year_stem` | 八字 |
| 宫位系统 | 占星十二宫位 | `house_1`, `house_10`, `ascendant` | 占星 |
| 行星位置 | 行星所在星座/宫位 | `planet_saturn`, `sun_sign`, `moon_house` | 占星 |
| 星座元素 | 黄道十二星座 | `sign_aries`, `element_fire_sign` | 占星 |
| 梦境结构 | 梦的场景与对象 | `dream.primary_pattern`, `dream.symbolic_motif` | 梦境 |

### 2.2 状态类因子（State）

描述动态属性、强弱、程度等可变状态。

| 子类 | 描述 | 示例因子ID | 取值类型 |
|------|------|------------|----------|
| 五行强弱 | 五行力量评估 | `wood_strength`, `fire_strength`, `metal_strength` | 数值(0-1) |
| 旺衰状态 | 天干地支旺衰 | `day_master_strength`, `wealth_star_strength` | 数值(0-1) |
| 受克状态 | 克制关系强度 | `kill_star_strength`, `official_star_strength` | 数值(0-1) |
| 梦境强度 | 梦的情绪与清晰度 | `dream.mood_valence`, `dream.recall_completeness` | 枚举值 |
| 心理张力 | 心理状态评估 | `emotional_tension`, `anxiety_level` | 数值(0-1) |

### 2.3 关系类因子（Relational）

描述元素间的相互作用、相位、合冲刑害等。

| 子类 | 描述 | 示例因子ID | 关系类型 |
|------|------|------------|----------|
| 合冲刑害 | 地支关系 | `has_liuhe`, `has_sanhe`, `has_chong` | 布尔值 |
| 相位关系 | 行星间角度 | `aspect_conjunction`, `aspect_square`, `aspect_trine` | 角度值 |
| 主客关系 | 用神忌神 | `yongshen_type`, `supports_usegod` | 枚举/布尔 |
| 守护关系 | 星体守护 | `ruler_planet`, `chart_ruler` | 引用ID |
| 代理关系 | 梦境代理 | `dream.proxy_relation_type`, `dream.proxy_reliability` | 枚举值 |

### 2.4 时间类因子（Temporal）

描述时间维度的因子，包括流年、大运、行运等。

| 子类 | 描述 | 示例因子ID | 时间粒度 |
|------|------|------------|-----------|
| 流年流月 | 当前时间点 | `current_year`, `current_month`, `solar_term` | 年/月/日 |
| 大运周期 | 十年大运 | `dayun_stem`, `dayun_branch`, `current_age` | 十年期 |
| 行运相位 | 行星过境 | `transit_saturn`, `progressed_sun` | 实时 |
| 时间窗口 | 特殊时段 | `dream.special_timing`, `dream.time_segment` | 特定时刻 |
| 季节节气 | 季节与节气 | `birth_season`, `season_spring`, `season_autumn` | 季节 |

### 2.5 能量/情绪类因子（Energy/Emotion）

描述能量流动、情绪状态、心理能量等。

| 子类 | 描述 | 示例因子ID | 度量方式 |
|------|------|------------|----------|
| 五行偏向 | 五行能量分布 | `wood_presence`, `earth_presence`, `dryness_index` | 比例值 |
| 情绪张力 | 情绪强度 | `emotional_tension`, `conflict_intensity` | 程度值 |
| 梦境能量 | 梦的能量状态 | `dream.scene_brightness`, `dream.omen_level` | 级别值 |
| 心理能量 | 心理动力 | `libido_level`, `ego_strength` | 强度值 |
| 和谐程度 | 整体和谐性 | `wealth_official_harmony`, `clarity_index` | 和谐度 |

---

## 3. 中西双轴对齐原则

### 3.1 对齐策略

不做东西方体系的一一硬对应，而是通过**中立标签**（Neutral Tags）实现语义统一。

### 3.2 中立标签体系

| 中立标签 | 英文 | 东方映射示例 | 西方映射示例 |
|----------|------|--------------|--------------|
| 资源冲突 | Resource_Conflict | 比劫夺财、财星被克 | 2宫-8宫对冲、金星受克 |
| 情绪张力 | Emotional_Tension | 伤官见官、枭印夺食 | 月亮刑土星、4宫受克 |
| 权威挑战 | Authority_Challenge | 七杀攻身、官杀混杂 | 太阳刑土星、10宫受克 |
| 事业助力 | Career_Support | 官印相生、食神生财 | 木星进10宫、太阳三合MC |
| 关系和谐 | Relationship_Harmony | 财官相生、日支合 | 金星合木星、7宫吉相 |
| 时机快速 | Timing_Fast | 驿马星动、冲动之年 | 火星过境、基本宫强 |
| 时机缓慢 | Timing_Slow | 墓库之年、土重 | 土星过境、固定宫强 |
| 转化契机 | Transformation_Opportunity | 岁运并临、三合成局 | 冥王星合相、8宫激活 |

### 3.3 映射规则

1. **东方因子** → 中立标签：
   ```
   比劫夺财 → Resource_Conflict
   伤官见官 → Emotional_Tension
   官印相生 → Career_Support
   ```

2. **西方因子** → 中立标签：
   ```
   Venus-Saturn-Square → Resource_Conflict
   Moon-Saturn-Opposition → Emotional_Tension  
   Jupiter-in-10th → Career_Support
   ```

3. **使用原则**：
   - L2层：记录原始因子（如 `bijie_duocai`, `venus_saturn_square`）
   - L3层：映射到中立标签
   - Narrative层：根据用户文化背景选择表述方式

---

## 4. 命名规范

### 4.1 因子ID命名规则

**基本格式**：`[prefix_]category_name`

**强制规范**：
- ✅ 全小写字母
- ✅ 下划线分隔
- ✅ 纯英文（不含中文、拼音）
- ✅ 语义清晰

**领域前缀**（可选）：
- `bazi_` - 八字专属因子
- `astro_` - 占星专属因子
- `dream_` - 梦境专属因子
- `psych_` - 心理学专属因子
- 无前缀 - 通用基础因子

### 4.2 命名示例

**正确示例**：
```
✅ day_master              # 通用基础因子
✅ wood_strength           # 五行强度
✅ planet_saturn           # 行星因子
✅ dream_primary_pattern   # 梦境模式（或用点号分隔）
✅ birth_season            # 出生季节
✅ aspect_conjunction      # 相位关系
```

**错误示例**：
```
❌ DayMaster              # 禁止驼峰命名
❌ mu_strength            # 禁止拼音
❌ 木strength             # 禁止中文
❌ day master             # 禁止空格
❌ day-master             # 禁止连字符
❌ dayMasterStrength      # 禁止驼峰
```

### 4.3 取值规范

| 因子类型 | 取值规范 | 示例 |
|----------|----------|------|
| 布尔型 | true/false | `has_liuhe: true` |
| 数值型 | 0-1范围或整数 | `strength_score: 0.75` |
| 枚举型 | 预定义字符串 | `mood_valence: "pleasant"` |
| 引用型 | 其他因子ID | `ruler_planet: "planet_jupiter"` |
| 字符串型 | 自由文本 | `day_master: "甲"` |

---

## 5. 提交流程

### 5.1 精校Agent工作流程

精校Agent在L1/L2文档中处理因子时：

1. **标注方式**：
   ```markdown
   | 因子标签（人话） | 因子ID | 因子来源 |
   |-----------------|--------|----------|
   | 甲木日主 | day_master_jia | existing |
   | 春不容金（新） |  | new_candidate |
   ```

2. **约束规则**：
   - 只能写"人话标签 + existing/new_candidate标记"
   - 不得自创因子ID
   - existing因子必须与本体完全一致

### 5.2 新因子入库流程

**new_candidate → existing 升级路径**：

```mermaid
graph LR
    A[精校发现new_candidate] --> B[汇总候选清单]
    B --> C[创建因子变更提案]
    C --> D[系统级评审]
    D --> E[分配唯一ID]
    E --> F[更新因子本体]
    F --> G[标记为existing]
    G --> H[可在规则中使用]
```

**具体步骤**：

1. **收集阶段**：
   - 精校Agent标记new_candidate
   - 定期汇总候选因子清单

2. **评审阶段**：
   - 创建`openspec/changes/add-factors-[batch]`
   - 评估必要性、唯一性、命名规范

3. **入库阶段**：
   - 在因子本体中正式登记
   - 分配符合规范的因子ID
   - 更新factors.dictionary.json

4. **启用阶段**：
   - 更新相关精校文档中的因子状态
   - 在L3规则中开始使用

### 5.3 变更管理要求

**创建因子变更时必须包含**：

1. **变更说明**（proposal.md）：
   - 新增因子清单
   - 使用场景说明
   - 与现有因子的区别

2. **因子定义**（specs/factors/）：
   - 因子ID
   - 中英文名称
   - 取值类型与范围
   - 适用系统

3. **影响评估**：
   - 受影响的规则
   - 需要更新的JSONL
   - 兼容性说明

---

## 6. 双语支持规范

### 6.1 因子双语标注

每个因子必须提供中英双语信息：

```yaml
- id: day_master_jia
  display_zh: 甲木日主
  display_en: Jia Wood Day Master
  aliases_zh: [甲木, 日干甲]
  aliases_en: [Jia DM, Wood DM]
  description_zh: 日柱天干为甲木
  description_en: Day stem is Jia Wood
```

### 6.2 术语一致性

- 同一概念必须使用统一术语
- 通过aliases处理同义词
- 中英术语必须语义对应

---

## 7. 质量保证

### 7.1 验证检查点

- [ ] 因子ID符合命名规范
- [ ] 不存在重复定义
- [ ] existing因子都有正式ID
- [ ] new_candidate都有升级计划
- [ ] 中英文信息完整
- [ ] 取值范围明确

### 7.2 定期审计

- 每月审计new_candidate积压
- 季度清理废弃因子
- 年度因子体系重构评估

---

## 8. 附录：常用因子速查表

### 8.1 八字核心因子
```
day_master          # 日主
birth_season        # 出生季节  
strength_score      # 强弱分数
wood_strength       # 木之力量
wealth_star_strength # 财星强度
official_star_strength # 官星强度
```

### 8.2 占星核心因子
```
planet_saturn       # 土星
house_1            # 第一宫
aspect_conjunction  # 合相
sun_sign           # 太阳星座
ascendant          # 上升点
```

### 8.3 梦境核心因子
```
dream.primary_pattern    # 梦境主模式
dream.mood_valence      # 情绪效价
dream.omen_level        # 征兆级别
dream.scene_brightness  # 场景亮度
```

### 8.4 中立标签
```
Resource_Conflict        # 资源冲突
Emotional_Tension       # 情绪张力
Authority_Challenge     # 权威挑战
Career_Support         # 事业助力
```

---

*本文档由Factor-Ontology-Agent维护，定义LucidSelf系统因子本体的总体框架与管理规范*
